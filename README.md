### 第一步：搭建TCP网桥服务器

**目的：**

建立一个TCP长连接一个网桥服务器,所谓的网桥，其实质就是一个TCP服务器和客户端。用来保证传递云端与终端的实时通信。这样的服务器百度有很多例子，在此不多赘述。

[bridgo.go](./bridge.go)  为部署在云端的网桥服务。

[client.go](./client.go) 部署在本地终端设备。

**思考：**

1.如何解决TCP粘包的问题？

2.客户端（终端）连接如何验证其身份？

3.是否需要指定类似HTTP协议一样的消息协议，以便于解析？

### 第二步：网桥验证和消息协议

##### 1.客户端接入验证

在生产中，客户端的接入是要被限制的。不能随便接入我们的网桥增加风险。验证身份合法性的方式有很多，我这里选择一种比较简单的方式，当客户端拨号成功获取连接后则向云端发送一段验证码，云端再验证验证码的有效性，有效则保持连接，无效则关闭连接。

##### 2.数据持久储存

在此，数据持久储存我选用了sqlite3来储存数据。使用gorm来进行操作数据库。验证码储存和传输都采用MD5 加密。

##### 3.消息协议

类似http协议一样，我们需要定一种消息协议来保证云端和客户端的正确的通信，防止漏读和粘包。 我这里采用如下方式：

|  消息类型   | 内容长度  | 内容 |
|  ----  | ----  |----|
| 4 byte | 4 byte(int32)|n byte|

